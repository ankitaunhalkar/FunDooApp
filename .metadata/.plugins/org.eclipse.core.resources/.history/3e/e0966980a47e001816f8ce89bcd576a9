package com.bridgelabz.fundoonotes.user.util;


import javax.mail.Message;
import javax.mail.internet.MimeMessage;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jms.annotation.JmsListener;
import org.springframework.mail.javamail.JavaMailSender;
import org.springframework.mail.javamail.MimeMessagePreparator;
import org.springframework.stereotype.Service;

import com.bridgelabz.fundoonotes.user.model.Mail;

@Service
public class MailConsumer  {

	@Autowired
	JavaMailSender emailSender;
	
	@JmsListener(destination = "email-queue")
	public void receiveMail(final Mail emailObj) {
		
		System.out.println(emailObj.getName());
		System.out.println(emailObj.getEmailId());
		
		final MimeMessagePreparator message = new MimeMessagePreparator() {
			
			@Override
			public void prepare(MimeMessage mimeMessage) throws Exception {
				
				mimeMessage.setRecipients(Message.RecipientType.TO, emailObj.getEmailId());
				mimeMessage.setSubject("Fundonotes Verification");
				mimeMessage.setText("Dear "+emailObj.getName()+",\n"+emailObj.getUrl()+emailObj.getToken());
	
			}
		};
		
		emailSender.send(message);
	}	
}
