package com.bridgelabz.fundoonotes.note.services;

import java.util.List;

import javax.transaction.Transactional;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.bridgelabz.fundoonotes.note.dao.INoteDao;
import com.bridgelabz.fundoonotes.note.model.CreateNoteDto;
import com.bridgelabz.fundoonotes.note.model.Note;
import com.bridgelabz.fundoonotes.user.dao.IUserDao;
import com.bridgelabz.fundoonotes.user.model.User;
import com.bridgelabz.fundoonotes.user.util.TokenUtil;

@Service
public class NoteService implements INoteService {

	@Autowired
	IUserDao userDao;

	@Autowired
	INoteDao noteDao;

	@Transactional
	@Override
	public long createNote(CreateNoteDto createNote, String token) {

		long userId = TokenUtil.parseJWT(token);

		Note note = new Note(createNote);

		note.setUser(userDao.getById(userId));

		long noteId = noteDao.saveNote(note);

		return noteId;
	}

	@Transactional
	@Override
	public List<Note> getNotes(String token) {

		List<Note> noteList = null;

		long userId = TokenUtil.parseJWT(token);

		User user = userDao.getById(userId);

		noteList = noteDao.getAllNotes(user);

		return noteList;
	}

	@Override
	public long updateNote(String token,CreateNoteDto updateNote) {
		
		long noteId = 0;

		Note note = new Note(updateNote);

		noteId = noteDao.updateNote(note);

		return noteId;
	}

}
